<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($scope,$location, $timeout, spModal, spUtil, $uibModal) {
  /* widget controller */
  var c = this;
	var s = $location.search();
	
	
	c.biopsyDisplay = false;
	c.cancerDisplay = false;
	c.surgeryDisplay = false;
	c.medicationDisplay = false;
	c.screeningDisplay = false;
	c.showWidget = false;
	
	c.show_view_index = 1;
	
	c.g_forms = {};
	
	c.current_form_idx = 'Introduction';
	
	c.startForm = function(){
		c.showView(2);
	}
	
	c.getFormValues = function() {
		var g_form = c.g_forms[c.current_form_idx];
		var fields = g_form.getFieldNames();
		var record = {};
		fields.forEach(function(field) {
			var f = g_form.getField(field);
			if(f.type == 'glide_date'){
				var dt_str = g_form.getValue(field);
				var d = new Date(dt_str);
				record[field] = d;
			}
			else{
				record[field] = g_form.getValue(field);
			}
			
		})
		return record;		
	}
	
	c.saveForm = function(cb){
		/*
		var modal = $uibModal.open({
			template: $('#saving-data-modal')[0].innerHTML,
			size: 'sm'
		});
		*/
		
		var record = c.getFormValues();
		$scope.server.get({
			action: 'update',
			record: record,
			sys_id: c.data.sys_id
		}).then(function(){
			var g_form = c.g_forms[c.current_form_idx];
			g_form.$private.userState.clearModifiedFields();
			spModal.open({
				title: "Message",
				message: "<center>Record has been saved successfully.</center>",
				buttons: [{label: 'OK', primary: true}]
			})
			if(cb){
				cb();
			}
		});	
	}
	
	c.submitForm = function(){
		c.saveForm(function(){
			//$('#thank_you').show();
		});
	}
	
	c.saveAndNextForm = function(){
		c.saveForm(function(){
			c.showView(c.show_view_index + 1);
		});
	};
	
	c.showView = function(idx){
		c.show_view_index = idx;
		if(idx != 1){
			if(idx == 2){
				c.current_form_idx = 'SectionA';
				if(!c.widget_2){
					spUtil.get("widget-form", {
						"sys_id": c.data.sys_id,
						"table": "x_naci_family_coho_individual_information_questionnaire",
						"view": 'SectionA'
					}).then(function(response) {
						response.data.hideRelatedLists = true;
						c.widget_2 = response;
					})
				}
				
			}
			else if(idx == 3){
				c.current_form_idx = 'SectionB1';
				if(!c.widget_3){
					
					spUtil.get("widget-form", {
						"sys_id": c.data.sys_id,
						"table": "x_naci_family_coho_individual_information_questionnaire",
						"view": 'SectionB1'
					}).then(function(response) {
						response.data.hideRelatedLists = true;
						c.widget_3 = response;
					})
				}
			}
			else if(idx == 4){
				c.current_form_idx = 'SectionB2';
				if(!c.widget_4){
					spUtil.get("widget-form", {
						"sys_id": c.data.sys_id,
						"table": "x_naci_family_coho_individual_information_questionnaire",
						"view": 'SectionB2'
					}).then(function(response) {
						response.data.hideRelatedLists = true;
						c.widget_4 = response;
					})
				}
			}
			else if(idx == 5){
				c.current_form_idx = 'SectionB3';
				if(!c.widget_5){
					spUtil.get("widget-form", {
						"sys_id": c.data.sys_id,
						"table": "x_naci_family_coho_individual_information_questionnaire",
						"view": 'SectionB3'
					}).then(function(response) {
						response.data.hideRelatedLists = true;
						c.widget_5 = response;
					})
				}
			}
			else if(idx == 6){
				c.current_form_idx = 'SectionB4';
				if(!c.widget_6){
					spUtil.get("widget-form", {
						"sys_id": c.data.sys_id,
						"table": "x_naci_family_coho_individual_information_questionnaire",
						"view": 'SectionB4'
					}).then(function(response) {
						response.data.hideRelatedLists = true;
						c.widget_6 = response;
					})
				}
			}
			else if(idx == 7){
				c.current_form_idx = 'SectionC';
				if(!c.widget_7){
					spUtil.get("widget-form", {
						"sys_id": c.data.sys_id,
						"table": "x_naci_family_coho_individual_information_questionnaire",
						"view": 'SectionC'
					}).then(function(response) {
						response.data.hideRelatedLists = true;
						c.widget_7 = response;
					})
				}
			}
			else{
				c.current_form_idx = 'SignatureAndSubmit';
				if(!c.widget_8){
					spUtil.get("widget-form", {
						"sys_id": c.data.sys_id,
						"table": "x_naci_family_coho_individual_information_questionnaire",
						"view": 'SignatureAndSubmit'
					}).then(function(response) {
						response.data.hideRelatedLists = true;
						c.widget_8 = response;
					})
				}
			}
			
			
		}
	}
	
	$scope.$on('spModel.fields.rendered', function(e, gFormInstance) {
		var g_form = null;
		if(['SectionA','SectionB1','SectionB2','SectionB3', 'SectionB4', 'SectionC', 'SignatureAndSubmit'].indexOf(e.targetScope.formModel.view) !== -1){
			var button_bar = $('.right-side-content #form_widget_'+c.show_view_index+' div.panel-footer');
			button_bar.html("");
			var html = '';
			if(e.targetScope.formModel.view == 'SignatureAndSubmit'){
				html += '<div><button type="submit" ng-click="c.submitForm()" class="btn btn-primary pull-right action-btn ng-scope" style="background-color:green; padding: 5px 25px;">Submit</button>';
			}
			else{
				html += '<div><button type="submit" ng-click="c.saveAndNextForm()" class="btn btn-primary pull-right action-btn ng-scope" style=" padding: 5px 25px;">Save & Next</button>';
			}
			html += '<button type="submit" ng-click="c.saveForm()" class="btn btn-primary pull-right action-btn ng-scope" style="padding: 5px 25px;">Save</button></div>';
			var content = $compile(html)($scope)[0];
			button_bar.append(content);
		}
		if(e.targetScope.formModel.view == "SectionA"){
			c.g_forms['SectionA'] = e.targetScope.getGlideForm();
		}
		else if(e.targetScope.formModel.view == "SectionB1"){
			c.g_forms['SectionB1'] = e.targetScope.getGlideForm();
			g_form = e.targetScope.getGlideForm();	
			var have_biopsy = g_form.getValue('have_biopsy');
			if(have_biopsy == 'YES'){
				c.biopsyDisplay = true;
			}
			else{
				c.biopsyDisplay = false;
			}
			var diagnosed_with_any_cancer = g_form.getValue('diagnosed_with_any_cancer');
			if(diagnosed_with_any_cancer == 'YES'){
				c.cancerDisplay = true;
			}
			else{
				c.cancerDisplay = false;
			}
			
			e.targetScope.$on('field.change.have_biopsy', function(ev, obj) {
				if(obj.newValue == 'YES'){
					c.biopsyDisplay = true;
				}
				else{
					c.biopsyDisplay = false;
				}
			});
			e.targetScope.$on('field.change.diagnosed_with_any_cancer', function(ev, obj) {
				if(obj.newValue == 'YES'){
					c.cancerDisplay = true;
				}
				else{
					c.cancerDisplay = false;
				}
			});
		}
		else if(e.targetScope.formModel.view == "SectionB2"){
			
			c.g_forms['SectionB2'] = e.targetScope.getGlideForm();
			g_form = e.targetScope.getGlideForm();	
			var have_any_surgery = g_form.getValue('have_any_surgery');
			if(have_any_surgery == 'YES'){
				c.surgeryDisplay = true;
			}
			else{
				c.surgeryDisplay = false;
			}
			
			e.targetScope.$on('field.change.have_any_surgery', function(ev, obj) {
				if(obj.newValue == 'YES'){
					c.surgeryDisplay = true;
				}
				else{
					c.surgeryDisplay = false;
				}
			});
		}
		else if(e.targetScope.formModel.view == "SectionB3"){
			c.g_forms['SectionB3'] = e.targetScope.getGlideForm();
			g_form = e.targetScope.getGlideForm();	
			var take_more_than_6_months = g_form.getValue('take_more_than_6_months');
			var taking_any_prescription_medication = g_form.getValue('taking_any_prescription_medication');
			if(take_more_than_6_months == 'YES' || taking_any_prescription_medication == 'YES'){
				c.medicationDisplay = true;
			}
			else{
				c.medicationDisplay = false;
			}
			
			e.targetScope.$on('field.change.take_more_than_6_months', function(ev, obj) {
				var v1 = c.g_forms['SectionB3'].getValue('take_more_than_6_months');
				var v2 = c.g_forms['SectionB3'].getValue('taking_any_prescription_medication');
				if(v1 == 'YES' || v2 == 'YES'){
					c.medicationDisplay = true;
				}
				else{
					c.medicationDisplay = false;
				}
			});
			
			e.targetScope.$on('field.change.taking_any_prescription_medication', function(ev, obj) {
				var v1 = c.g_forms['SectionB3'].getValue('take_more_than_6_months');
				var v2 = c.g_forms['SectionB3'].getValue('taking_any_prescription_medication');
				if(v1 == 'YES' || v2 == 'YES'){
					c.medicationDisplay = true;
				}
				else{
					c.medicationDisplay = false;
				}
			});
		}
		else if(e.targetScope.formModel.view == "SectionB4"){
			c.g_forms['SectionB4'] = e.targetScope.getGlideForm();
		}
		else if(e.targetScope.formModel.view == "SectionC"){
			c.g_forms['SectionC'] = e.targetScope.getGlideForm();
			g_form = e.targetScope.getGlideForm();
			var had_screening_for_cancer = g_form.getValue('had_screening_for_cancer');
			if(had_screening_for_cancer == 'YES'){
				c.screeningDisplay = true;
			}
			else{
				c.screeningDisplay = false;
			}
			
			e.targetScope.$on('field.change.had_screening_for_cancer', function(ev, obj) {
				var v1 = c.g_forms['SectionC'].getValue('had_screening_for_cancer');
				if(v1 == 'YES'){
					c.screeningDisplay = true;
				}
				else{
					c.screeningDisplay = false;
				}
			});
		}
		else{
			c.g_forms['SignatureAndSubmit'] = e.targetScope.getGlideForm();
		}
	});
}]]></client_script>
        <controller_as>c</controller_as>
        <css>#sp_formfield_date_of_birth,#sp_formfield_date_had_this_biopsy,#sp_formfield_date,#sp_formfield_date_surgery,#sp_formfield_date_completed_questionnaire,#sp_formfield_date_last_screening_test{
  pointer-events:none;
  background-color: lightgray;
}
.field-actual input{
  font-size: 16px;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>fcsms_iiq_form</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>FCSMS IIQ Form</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
  /* populate the 'data' object */
  /* e.g., data.table = $sp.getValue('table'); */
	var str = gs.action.getGlideURI();
	var sys_id = str.get('sys_id');
	data.sys_id = sys_id;
	
	if(input){
		if(input.action == 'update'){
			var record = input.record;
			var gr1 = new GlideRecord('x_naci_family_coho_individual_information_questionnaire');
			gr1.get(input.sys_id);
			for (var key in record) {
				var value = record[key];
				gr1.setValue(key, value);
			}
			gr1.updateMultiple();
		}
	}
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>yuw5@nih.gov</sys_created_by>
        <sys_created_on>2019-09-23 16:04:08</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>048fff7ddb8c8c1054d8ff621f9619ac</sys_id>
        <sys_mod_count>391</sys_mod_count>
        <sys_name>FCSMS IIQ Form</sys_name>
        <sys_package display_value="Family Cohort Study" source="x_naci_family_coho">090e9eb7dba7774054d8ff621f9619eb</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Family Cohort Study">090e9eb7dba7774054d8ff621f9619eb</sys_scope>
        <sys_update_name>sp_widget_048fff7ddb8c8c1054d8ff621f9619ac</sys_update_name>
        <sys_updated_by>yuw5@nih.gov</sys_updated_by>
        <sys_updated_on>2019-10-10 19:29:31</sys_updated_on>
        <template><![CDATA[<div id="table-form" class="container" style="width:80%;font-size: 18px;">
  <div class="left-side-menu col-md-3">
    <ul>
      <li ng-class="{'active': c.show_view_index == 1}" ng-click="c.showView(1)"><i class="fa fa-check-circle fa-check-circle-green" aria-hidden="true"></i><a href="javascript:void(0);">Introduction</a></li>
      <li ng-class="{'active': c.show_view_index == 2}" ng-click="c.showView(2)"><i class="fa fa-check-circle fa-check-circle-green" aria-hidden="true"></i><a href="javascript:void(0);">Demographic Information</a></li>
      <li ng-class="{'active': c.show_view_index == 3}" ng-click="c.showView(3)"><i class="fa fa-circle-o" aria-hidden="true"></i><a href="javascript:void(0);">Biopsy(ies) & Cancer(s)</a></li>
      <li ng-class="{'active': c.show_view_index == 4}" ng-click="c.showView(4)"><i class="fa fa-circle-o" aria-hidden="true"></i><a href="javascript:void(0);">Surgery(ies) & Medical Conditions</a></li>
      <li ng-class="{'active': c.show_view_index == 5}" ng-click="c.showView(5)"><i class="fa fa-circle-o" aria-hidden="true"></i><a href="javascript:void(0);">Medications & Supplements</a></li>
      <li ng-class="{'active': c.show_view_index == 6}" ng-click="c.showView(6)"><i class="fa fa-circle-o" aria-hidden="true"></i><a href="javascript:void(0);">Health Practices</a></li>
      <li ng-class="{'active': c.show_view_index == 7}" ng-click="c.showView(7)"><i class="fa fa-circle-o" aria-hidden="true"></i><a href="javascript:void(0);">Screening Tests</a></li>
      <li ng-class="{'active': c.show_view_index == 8}" ng-click="c.showView(8)"><i class="fa fa-circle-o" aria-hidden="true"></i><a href="javascript:void(0);">Signature & Submit</a></li>
    </ul>
  </div>
  <div class="right-side-content col-md-9">
      <div ng-show="c.show_view_index == 1">
        <div style="padding: 10px;border: 1px solid #ddd;border-radius: 5px 5px 0px 0px;border-bottom: 0px;" >
          <h3 style="text-align:center;">
             NATIONAL CANCER INSTITUTE
          <br>
            LI-FRAUMENI SYNDROME STUDY 
          <br>
            INDIVIDUAL INFORMATION QUESTIONNAIRE 
          </h3>
          <p>
            We appreciate your willingness to participate in the Li-Fraumeni Syndrome Study. As part of this project, we would like to gather some information about your medical history. We will ask you to provide some specific information about aspects of your health that might relate to your own risk of cancer, as well as information about screening tests and procedures you may have had. If you are younger than 18 years old, please have an adult help you to make sure that your answers are complete.  
          </p>	
          <p>
            Completing the questions that follow takes about 45 minutes. Completing this questionnaire is voluntary. Your answers to these questions will help in our research effort. Since answering these questions might involve thinking about how Li-Fraumeni Syndrome has affected yourself and your family, it is possible that it might cause you to feel sad. You will have an opportunity to discuss these feelings with our clinic staff at the time of your visit. If you need to contact us, please call 1-800-518-8474.  
          </p>

        </div>
        <div style="background-color: #f5f5f5;border: 1px solid #ddd;border-radius:  0px 0px 5px 5px;height: 60px;padding: 10px 15px;">
          <button type="submit" ng-click="c.startForm()" class="btn btn-primary pull-right action-btn ng-scope" style=" padding: 5px 25px;">Next</button>
        </div>
      </div>
    	
    	<div style="" id="form_widget_2" ng-show="c.show_view_index == 2">
        <sp-widget widget="c.widget_2">
        	<i class="fa fa-cog fa-spin fa-10x fa-fw"></i>
          Loading...
        </sp-widget>
      </div>
    
			<div style="" id="form_widget_3" ng-show="c.show_view_index == 3">
        <sp-widget widget="c.widget_3">
        	<i class="fa fa-cog fa-spin fa-10x fa-fw"></i>
          Loading...
        </sp-widget>
        <div ng-show="c.biopsyDisplay" class="div-inset-list">
          <widget id="fcsms_iiq_form_biopsy_list"></widget>
        </div>
        <div ng-show="c.cancerDisplay" class="div-inset-list">
          <widget id="fcsms_iiq_form_cancer_list"></widget>
        </div>
      </div>
    	<div style="" id="form_widget_4" ng-show="c.show_view_index == 4">
        <sp-widget widget="c.widget_4">
        	<i class="fa fa-cog fa-spin fa-10x fa-fw"></i>
          Loading...
        </sp-widget>
        <div ng-show="c.surgeryDisplay" class="div-inset-list">
          <widget id="fcsms_iiq_form_surgery_list"></widget>
        </div>
      </div>
    	<div style="" id="form_widget_5" ng-show="c.show_view_index == 5">
        <sp-widget widget="c.widget_5">
        	<i class="fa fa-cog fa-spin fa-10x fa-fw"></i>
          Loading...
        </sp-widget>
        <div ng-show="c.medicationDisplay" class="div-inset-list">
          <widget id="fcsms_iiq_form_medication_list"></widget>
        </div>
        <div class="div-inset-list">
          <widget id="fcsms_iiq_form_supplement_list"></widget>
        </div>
      </div>
    
    	<div style="" id="form_widget_6" ng-show="c.show_view_index == 6">
        <sp-widget widget="c.widget_6">
        	<i class="fa fa-cog fa-spin fa-10x fa-fw"></i>
          Loading...
        </sp-widget>
      </div>
    
    	<div style="" id="form_widget_7" ng-show="c.show_view_index == 7">
        <sp-widget widget="c.widget_7">
        	<i class="fa fa-cog fa-spin fa-10x fa-fw"></i>
          Loading...
        </sp-widget>
        <div ng-show="c.screeningDisplay" class="div-inset-list">
          <widget id="fcsms_iiq_form_screening_test_list"></widget>
        </div>
      </div>
    	<div style="" id="form_widget_8" ng-show="c.show_view_index == 8">
        <sp-widget widget="c.widget_8">
        	<i class="fa fa-cog fa-spin fa-10x fa-fw"></i>
          Loading...
        </sp-widget>
      </div>
  </div>
  
</div>
<div id="saving-data-modal" style="display: none;">
  <div class="modal-body text-center" style="font-size: 20px;">
    <i class="fa fa-cog fa-spin fa-10x fa-fw"></i> Saving...
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
