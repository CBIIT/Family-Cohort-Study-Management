<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($scope,$location, $timeout, $uibModal, spUtil, spModal) {
	/* widget controller */
	var c = this;
	$('#intake_id').val(c.data.id);
	c.forms = {};
	var s = $location.search();
	//	spModal.open(c.data.formOptions)
	window.show_cancer = null;
	window.displayThankYou = function(){

		var obj = document.getElementById('thank_you');
		if(obj.style.display == 'none'){
			obj.style.display = 'block';
		}
	}

	setTimeout(function(){
		var button_bar = $('#submit_div div.panel-footer');
		button_bar.children().last().remove();
		var button = button_bar.children().last();
		button_bar.append('<button type="submit" onClick="displayThankYou()" class="btn btn-primary action-btn ng-scope" style="background-color:green;">Submit</button>');
		//$('<button type="submit" onClick="displayThankYou()" class="btn btn-primary action-btn ng-scope">Submit</button>').insertBefore(button);
	}, 0);

	c.goBack = function(){
		s.id = null;
		$location.search(s).replace();
	}

	$scope.saveForm = function(form){
		var modal = $uibModal.open({
			template: $('#saving-data-modal')[0].innerHTML,
			size: 'sm'
		});
		
		var record = getFormValues(form);
		$scope.server.get({
			action: 'update',
			record: record,
			sys_id: c.data.id
		}).then(function(){
			$('#loading').hide();
			modal.close();
			spModal.open({
				title: "Message",
				message: "<center><b>Record has been updated successfully</b><center>",
				buttons: [{label: 'OK', primary: true}]
			})
		});	
	}
	
	$scope.submitForm = function(form){
		$scope.saveForm(form);
		$('#thank_you').show();
	}
	
	$scope.loadTab = function(index) {
		var widgetName = 'widget_' + index;
		var view = 'LFS' + index;

		if (!c.data[widgetName]) {
			spUtil.get('widget-form', {
				sys_id: c.data.id,
				table: "x_naci_family_coho_mock_up_intake",
				view: view
			}).then(function(widget) {
				console.log(widget);
				c.data[widgetName] = widget;
			})
		}
	}
	
	
	function getFormValues(gForm) {
		var fields = gForm.getFieldNames();
		var record = {};
		fields.forEach(function(field) {
			var f = gForm.getField(field);
			if(f.type == 'glide_date'){
				var dt_str = gForm.getValue(field);
				var d = new Date(dt_str);
				record[field] = d;
			}
			else{
				record[field] = gForm.getValue(field);
			}
		})
		return record;		
	}

	$scope.$on('spModel.fields.rendered', function(e, gFormInstance) {
		var g_form = e.targetScope.getGlideForm()
		var view = e.targetScope.formModel.view;
		c.forms[view] = g_form;
		if(view == "LFS2"){
			$timeout(function(){
				$('input[name="birthday"]').prop('readonly',true);		
			});
	   
		}
		if(view == "LFS3"){
			if(g_form.getValue('diagnosed_with_cancer') == 'Yes'){
				window.setShowCancer(true);
			}else{
				window.setShowCancer(false);
			}

			e.targetScope.$on('field.change.diagnosed_with_cancer', function(ev, obj) {
				if(obj.newValue == 'Yes'){
					window.setShowCancer(true);
				}else{
					window.setShowCancer(false);
				}
			});
		}
		if (view == "LFS4"){
			if(g_form.getValue('biological_relatives_diagnosed') == 'Yes'){
				window.setShowFamilyCancer(true);
			}else{
				window.setShowFamilyCancer(false);
			}
			e.targetScope.$on('field.change.biological_relatives_diagnosed', function(ev, obj) {
				if(obj.newValue == 'Yes'){
					window.setShowFamilyCancer(true);
				}else{
					window.setShowFamilyCancer(false);
				}
			});
		}
		if(view == "LFS41"){
			if(g_form.getValue('relatives_had_genetic_testing') == 'No'){
				window.setShowTest(false);
      }else{
				if(g_form.getValue('relatives_test_positive') == 'Yes'){
					window.setShowTest(true);
				}else{
					window.setShowTest(false);
				}
			}
			e.targetScope.$on('field.change.relatives_had_genetic_testing', function(ev, obj) {
				if(obj.newValue == 'No'){
					window.setShowTest(false);
				}else{
					if(g_form.getValue('relatives_test_positive') == 'Yes'){
						window.setShowTest(true);
					}else{
						window.setShowTest(false);
					}
				}
			});
			if(g_form.getValue('relatives_test_positive') == 'Yes'){
				if(g_form.getValue('relatives_had_genetic_testing') == 'Yes'){
					window.setShowTest(true);
				}else{
					window.setShowTest(false);
				}
			}else{
				window.setShowTest(false);
			}		
			e.targetScope.$on('field.change.relatives_test_positive', function(ev, obj) {
				if(obj.newValue == 'Yes'){
					window.setShowTest(true);
				}else{
					window.setShowTest(false);
				}
			});
		}
		if (view == "LFS5"){
			if(g_form.getValue('participated_through_another_institution') == 'Yes'){
				window.setShowAnother(true);
			}else{
				window.setShowAnother(false);
			}
			e.targetScope.$on('field.change.participated_through_another_institution', function(ev, obj) {
				if(obj.newValue == 'Yes'){
					window.setShowAnother(true);
				}else{
					window.setShowAnother(false);
				}
			});

			if(g_form.getValue('received_cancer_care') == 'Yes'){
				window.setShowFollowUp(true);
			}else{
				window.setShowFollowUp(false);
			}
			e.targetScope.$on('field.change.received_cancer_care', function(ev, obj) {
				if(obj.newValue == 'Yes'){
					window.setShowFollowUp(true);
				}else{
					window.setShowFollowUp(false);
				}
			});			
		}

	});
}]]></client_script>
        <controller_as>c</controller_as>
        <css>div legend{
	display:none;
}
div .alert{
  display:none;
}
div .panel-heading{
  display:none;
}
fieldset label{
  font-weight: bold;
}
.form-group{
  margin-bottom: 10px;
}
.panel-footer button.btn-default{
  display:none;
}
#submit_div .panel-footer{
	width:100%;
  text-align:right;
}
.btn{
  font-size: 22px;
}
.input-group-btn button{
  padding: 0px 6px 1px 6px;
}
.select2-container-multi input{
	height: 30px;
}

#widget_1 div .panel-footer{
  display:none;
}
#widget_2 div .panel-footer{
  display:none;
}
#widget_3 div .panel-footer{
  display:none;
}
#widget_4 div .panel-footer{
  display:none;
}
#submit_div div .panel-footer{
  display:none;
}
#widget_41 .panel-footer {
  display:none;
}
.tab-pane {
  padding: 15px;
  box-shadow: 0 10px 10px rgba(0, 0, 0, 0.2);
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>fcsms_intake_form</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>FCSMS Intake Form</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
	/* populate the 'data' object */
	/* e.g., data.table = $sp.getValue('table'); */
	// data.form = $sp.getForm("x_naci_family_coho_mock_up_intake","-1");
	var str = gs.action.getGlideURI();
	var sys_id = str.get('sys_id');
	data.id = sys_id;
	if(sys_id == null){
		sys_id = "-1";
	}

	if(input){
		if(input.action == 'update'){
			var record = input.record;
			var gr1 = new GlideRecord('x_naci_family_coho_mock_up_intake');
			gr1.get(input.sys_id);
			for (var key in record) {
				gr1.setValue(key, record[key]);
			}
			gr1.updateMultiple();
		}
	}
	data.widget_1 = $sp.getWidget('widget-form', {
		"sys_id": sys_id,
		"table": "x_naci_family_coho_mock_up_intake",
		"view": "LFS1"
	});
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>yuw5@nih.gov</sys_created_by>
        <sys_created_on>2019-09-09 19:11:48</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>f034a869db337f4054d8ff621f9619a5</sys_id>
        <sys_mod_count>507</sys_mod_count>
        <sys_name>FCSMS Intake Form</sys_name>
        <sys_package display_value="Family Cohort Study" source="x_naci_family_coho">090e9eb7dba7774054d8ff621f9619eb</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Family Cohort Study">090e9eb7dba7774054d8ff621f9619eb</sys_scope>
        <sys_update_name>sp_widget_f034a869db337f4054d8ff621f9619a5</sys_update_name>
        <sys_updated_by>yuw5@nih.gov</sys_updated_by>
        <sys_updated_on>2019-10-07 20:17:27</sys_updated_on>
        <template><![CDATA[<div id="table-form" class="container" style="width:80%;font-size: 20px;">
  <uib-tabset>
    <uib-tab index="0" heading="Study Introduction">
      <div style="padding: 10px;">
        <p>
          Li-Fraumeni syndrome (LFS) is an inherited cancer predisposition syndrome which is associated with an increased risk of developing cancer in individuals who have the syndrome.  Some of the most common cancers that occur in LFS are brain cancer, breast cancer, sarcomas, adrenal cortical cancer, and blood cancers, though other cancers are possible as well.  The National Cancer Institute is studying individuals with family histories suspicious of LFS in order to better understand how genes or other risk factors cause cancers in these families, what cancers are most common in these families, and what strategies are best for preventing cancer or catching cancer early.  More information about the study can be found at <a target="_blank" href="http://lfs.cancer.gov">http://lfs.cancer.gov</a>. 
        </p>
        <p>
          You can learn about your eligibility for this study by providing the information requested below.  In order to determine whether you are eligible, the information  requested must be provided  and should take approximately 10-15 minutes to complete.  Before beginning, make sure you have as much information as possible available about your familyâ€™s cancer history, including the types of cancers diagnosed in yourself or your relatives and the approximate ages at diagnosis. 
          </p>
        <p>
          Our study team will review the information provided to determine if you may be eligible to participate.  If you enroll in the study, you may be asked to do some or all of the following: 
          </p>
        <ul>
          <li>
            Sign a study consent form 
          </li>
          <li>
            Provide information and complete questionnaires about your family history and your personal health history 
          </li>
          <li>
            Grant permission for us to verify their cancer diagnoses 
          </li>
          <li>
            Provide biologic samples (such as a blood sample or saliva sample) 
          </li>
          <li>
            Allow us to contact family members, such as siblings, parents, aunts or uncles, to invite them to participate in the study 
          </li>
        </ul>
        <p>
          Please note that cancer treatment is not being offered as part of this protocol. 
        </p>
        <p>
          If you are unable to complete the online questionnaire or would prefer to complete it by phone, please contact our study nurse, Janet Bracci at ###-###-####. 
        </p>
        <div id="widget_1" class="clearfix">
        	<sp-widget widget="c.data.widget_1"></sp-widget>
          <button class="btn btn-primary pull-right" ng-click="saveForm(c.forms.LFS1)" style="width:100px">
            SAVE
          </button>
        </div>
      </div>
    </uib-tab>
    <uib-tab index="1" heading="Personal Information" ng-click="loadTab(2)">
      <div id="widget_2" style="padding: 10px;" class="clearfix">
        <sp-widget widget="c.data.widget_2">
          <i class="fa fa-cog fa-spin fa-10x fa-fw"></i>
          Loading...
        </sp-widget>
        <button class="btn btn-primary pull-right" ng-click="saveForm(c.forms.LFS2)" style="width:100px">
            SAVE
          </button>
      </div>
    </uib-tab>
    <uib-tab index="2" heading="Personal Cancer History" ng-click="loadTab(3)">
      <div id="widget_3" style="padding: 10px;" class="clearfix">
        <sp-widget widget="c.data.widget_3">
          <i class="fa fa-cog fa-spin fa-10x fa-fw"></i>
          Loading...
        </sp-widget>
        <button class="btn btn-primary pull-right" ng-click="saveForm(c.forms.LFS3)" style="width:100px;">
            SAVE
         </button> 
      </div>
      <div>
         <widget id="fcsms_intake_form_personal_cancer_list"></widget>
      </div>
    </uib-tab>
    <uib-tab index="3" heading="Family Memebers' Cancer History" ng-click="loadTab(4)">
      <div id="widget_4" style="padding: 10px;" class="clearfix">
        <sp-widget widget="c.data.widget_4">
          <i class="fa fa-cog fa-spin fa-10x fa-fw"></i>
          Loading...
        </sp-widget>
        <button class="btn btn-primary pull-right" ng-click="saveForm(c.forms.LFS4)" style="width:100px">
            SAVE
         </button>   
      </div>
      <div>
         <widget id="fcsms_intake_form_family_cancer_list"></widget>
      </div>
    </uib-tab>
    <uib-tab index="5" heading="Family Members' Genetic Tests" ng-click="loadTab(41)">
    	<div id="widget_41" style="padding: 10px;" class="clearfix">
        <sp-widget widget="c.data.widget_41">
          <i class="fa fa-cog fa-spin fa-10x fa-fw"></i>
          Loading...
				</sp-widget>
          <button class="btn btn-primary pull-right" ng-click="saveForm(c.forms.LFS41)" style="width:100px">
            SAVE
         </button>         
      </div>
       <div>
         <widget id="fcsms_intake_test_positive_for_gene"></widget>
      </div>
    </uib-tab>
    <uib-tab index="5" heading="Final Information" ng-click="loadTab(5)">
      <div style="padding: 10px;" id="submit_div" class="clearfix">
        <sp-widget widget="c.data.widget_5">
          <i class="fa fa-cog fa-spin fa-10x fa-fw"></i>
          Loading...
        </sp-widget>
        <div class="text-right">
          <button class="btn btn-primary" ng-click="saveForm(c.forms.LFS5)" style="width:100px; margin-right: 10px;">
            SAVE
          </button>
          <button class="btn btn-success" ng-click="submitForm(c.forms.LFS5)" style="width:100px;">
            SUBMIT
          </button>
        </div>
          
      </div>
      <div>
        <widget id="fcsms_participate_another_org"></widget>
        <widget id="fcsms_cancer_follow_up"></widget>        
      </div>
      <div Style="display:none;padding: 10px;" id="thank_you">
        <p>
          Thank you very much. The information you have provided will be reviewed by our study team.  If they agree that you are eligible to participate in the study of Li-Fraumeni or Li-Fraumeni like syndromes, you will receive an email with further instructions, including instructions to log in to a secure study portal. If the team decides that you are not eligible, you will receive an email explaining why.  In the meantime, you should receive an email confirming this submission. 
        </p>
        <p>
					Please feel free to call at any time if you have any questions regarding this protocol.  Ask to speak with Janet Bracci, who is the Study Nurse.  Our toll-free phone number is 1-800-518-8474. Thank you for your willingness to consider joining our research effort.  We could not do vital studies like this without the help of dedicated people like you. 
        </p>
      </div>
    </uib-tab>
  </uib-tabset>
  <input type="hidden" id="intake_id"/>
 
  
  <div id="saving-data-modal" style="display: none">
    <div class="modal-body text-center">
      <h3>Please Wait</h3>
      <i class="fa fa-cog fa-spin fa-10x fa-fw" style="font-size: 40px"></i>
    </div>
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
